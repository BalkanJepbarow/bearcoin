<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <title>Bear Clicker</title>

    <!-- –í–∞—à–∏ —Å—Ç–∏–ª–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã (Telegram, eruda, –∏ —Ç.–¥.) -->
    <link rel="stylesheet" href="TemplateData/style.css" />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="//cdn.jsdelivr.net/npm/eruda"></script>

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />

    <style>
      /* –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã –∏ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º html –∏ body */
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        touch-action: none;
      }

      /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ */
      #loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: #000; /* –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç */
        z-index: 9999;         /* –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
      }

      /* –í–∏–¥–µ–æ, —Ä–∞—Å—Ç—è–Ω—É—Ç–æ–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
      #loading-screen video {
        width: 100%;
        height: 100%;
        object-fit: fill;
        display: block;
      }

      /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä Unity ‚Äì –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç */
      #unity-container {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }

      /* –ö–∞–Ω–≤–∞—Å Unity */
      #unity-canvas {
        width: 100%;
        height: 100%;
        background-color: #000;
        -webkit-overflow-scrolling: auto; /* –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—ã–ª–µ–∑–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞ iOS */
      }
    </style>
  </head>
  <body>

    <!-- –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω —Å MP4-–≤–∏–¥–µ–æ -->
    <div id="loading-screen">
      <video autoplay muted loop playsinline>
        <!-- –í–∞—à MP4-—Ñ–∞–π–ª -->
        <source src="https://www.bearcoin.pro/static/coin-loader-12.mp4" type="video/mp4" />
      </video>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è Unity -->
    <div id="unity-container">
      <canvas id="unity-canvas" width="1080" height="1920"></canvas>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Unity Loader -->
    <script src="Build/BearcoinBuild.loader.js"></script>
    <script>
      eruda.init(); // –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

      var unityInstance = null;

      // –§—É–Ω–∫—Ü–∏—è, –≤—ã–∑—ã–≤–∞–µ–º–∞—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Unity
      function onUnityLoaded() {
        // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–≥—Ä–æ–π
        document.getElementById("loading-screen").style.display = "none";
        document.getElementById("unity-container").style.display = "block";
        console.log("[Unigram Payment] Unity instance successfully loaded");
      }
      // Default Unity config (Unity replaces ___BuildName___ etc.)
      const config = {
        dataUrl: "Build/BearcoinBuild.data.br",
        frameworkUrl: "Build/BearcoinBuild.framework.js.br",
        codeUrl: "Build/BearcoinBuild.wasm.br",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "Bear Clicker",
        productVersion: "1.0",
        devicePixelRatio: window.devicePixelRatio,
        memoryGrowth: true
      };

        /* ===========================================================
           üì± MOBILE FIX: Reduce pixel density to avoid WebGL crashes
           =========================================================== */
      if (/(iPhone|iPad|Android)/i.test(navigator.userAgent)) {
          config.devicePixelRatio = 1;
      }

        /* ===========================================================
           ü§ñ TELEGRAM FIX: Enable memoryGrowth + reduce pixel ratio
           =========================================================== */
      if (navigator.userAgent.includes("Telegram")) {
          config.devicePixelRatio = 1;
          config.memoryGrowth = true;
      }  

      // –ó–∞–ø—É—Å–∫–∞–µ–º Unity
      createUnityInstance(document.querySelector("#unity-canvas"), config)
        .then((instance) => {
          unityInstance = instance;
          onUnityLoaded();
        })
        .catch((error) => {
          console.error("Error loading Unity instance:", error);
        });

      // –û—Å—Ç–∞–ª—å–Ω–æ–π –≤–∞—à JS-–∫–æ–¥ (—Ä–∞–±–æ—Ç–∞ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π, Telegram.WebApp, lockOrientation –∏ —Ç.–¥.) –Ω–∏–∂–µ:
      
      var KeyboardManagerJS = {
        isKeyboardVisible: false,
        initialHeight: window.innerHeight,
        cooldown: false,
        init: function () {
          this.initialHeight = window.innerHeight;
          window.addEventListener("resize", this.onResize.bind(this));
        },
        onResize: function () {
          if (this.cooldown) return;
          var currentHeight = window.innerHeight;
          var heightDifference = this.initialHeight - currentHeight;
          var threshold = 150;

          if (heightDifference > threshold && !this.isKeyboardVisible) {
            this.isKeyboardVisible = true;
            console.log("KeyboardManagerJS: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø–æ–∫–∞–∑–∞–Ω–∞");
            this.sendMessageToUnity("OnKeyboardShowMessage");
            this.cooldown = true;
            setTimeout(() => {
              this.cooldown = false;
            }, 500);
          } else if (heightDifference < threshold && this.isKeyboardVisible) {
            this.isKeyboardVisible = false;
            console.log("KeyboardManagerJS: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–∫—Ä—ã—Ç–∞");
            this.sendMessageToUnity("OnKeyboardHideMessage");
            this.cooldown = true;
            setTimeout(() => {
              this.cooldown = false;
            }, 500);
          }
        },
        sendMessageToUnity: function (methodName) {
          if (unityInstance && unityInstance.SendMessage) {
            console.log(`[KeyboardManagerJS] –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Unity: ${methodName}`);
            unityInstance.SendMessage("KeyboardManager", methodName, "");
          } else if (unityInstance && unityInstance.Module && unityInstance.Module.SendMessage) {
            unityInstance.Module.SendMessage("KeyboardManager", methodName, "");
          } else {
            console.warn("KeyboardManagerJS: Unity instance –∏–ª–∏ SendMessage –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã");
          }
        },
      };

      document.addEventListener("focusin", () => {
        document.body.style.position = "fixed";
      });
      document.addEventListener("focusout", () => {
        document.body.style.position = "";
      });

      window.addEventListener("load", function () {
        KeyboardManagerJS.init();
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        var isMobile = /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        if (isMobile) {
          Telegram.WebApp.requestFullscreen();
        } else {
          console.log("[Unigram Payment] Fullscreen –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è ‚Äì —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –º–æ–±–∏–ª—å–Ω–æ–µ");
        }
        Telegram.WebApp.lockOrientation();
        console.log("[Unigram Payment] Telegram web app expanded to full screen");
      });
    </script>
  </body>
</html>
